<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FCE Speaking Test Random Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .part-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .part-btn {
            padding: 20px;
            font-size: 1.2em;
            font-weight: bold;
            border: 3px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .part-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .part-btn.active {
            background: #667eea;
            color: white;
        }
        
        .random-btn {
            width: 100%;
            padding: 20px;
            font-size: 1.5em;
            font-weight: bold;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }
        
        .random-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(245, 87, 108, 0.4);
        }
        
        .random-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            min-height: 200px;
            display: none;
        }
        
        .result.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .question {
            background: white;
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            font-size: 1.1em;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .image-item {
            text-align: center;
        }
        
        .image-item img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 10px;
            border: 3px solid #667eea;
        }
        
        .image-item p {
            margin-top: 10px;
            font-weight: bold;
            color: #667eea;
        }
        
        .placeholder {
            width: 100%;
            height: 300px;
            background: #e9ecef;
            border-radius: 10px;
            border: 3px dashed #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #667eea;
            font-weight: bold;
        }
        
        .admin-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            z-index: 1000;
        }
        
        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .admin-panel.show {
            display: block;
        }
        
        .admin-content {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .close-btn {
            padding: 10px 20px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .upload-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .upload-section h3 {
            margin-bottom: 15px;
            color: #667eea;
        }
        
        .paste-area {
            width: 100%;
            height: 150px;
            border: 3px dashed #667eea;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #667eea;
            font-weight: bold;
            cursor: pointer;
            background: white;
        }
        
        .paste-area:focus {
            outline: none;
            border-color: #f5576c;
            background: #fff5f7;
        }
        
        .preview-img {
            max-width: 200px;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 10px;
        }
        
        .save-btn {
            margin-top: 10px;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .test-selector {
            margin-bottom: 20px;
        }
        
        .test-selector select {
            padding: 10px;
            font-size: 1em;
            border-radius: 10px;
            border: 2px solid #667eea;
            width: 200px;
        }
    </style>
</head>
<body>
    <button class="admin-toggle" onclick="toggleAdmin()">üîß Admin Mode</button>
    
    <div class="container">
        <div class="header">
            <h1>FCE Speaking Test</h1>
            <p>Random Question Generator</p>
        </div>
        
        <div class="content">
            <div class="part-selector">
                <button class="part-btn" onclick="selectPart(1)">Part 1<br>Interview</button>
                <button class="part-btn" onclick="selectPart(2)">Part 2<br>Photo Description</button>
                <button class="part-btn" onclick="selectPart(3)">Part 3<br>Discussion</button>
                <button class="part-btn" onclick="selectPart(4)">Part 4<br>General Discussion</button>
            </div>
            
            <button class="random-btn" id="randomBtn" onclick="randomQuestion()" disabled>
                Ch·ªçn Part ƒë·ªÉ Random
            </button>
            
            <div class="result" id="result"></div>
        </div>
    </div>
    
    <div class="admin-panel" id="adminPanel">
        <div class="admin-content">
            <div class="admin-header">
                <h2>Admin Panel - Upload Images</h2>
                <button class="close-btn" onclick="toggleAdmin()">Close</button>
            </div>
            
            <div class="test-selector">
                <label>Select Test: </label>
                <select id="testSelect" onchange="updateImageList()">
                    <option value="1">Test 1</option>
                    <option value="2">Test 2</option>
                    <option value="3">Test 3</option>
                    <option value="4">Test 4</option>
                    <option value="5">Test 5</option>
                    <option value="6">Test 6</option>
                    <option value="7">Test 7</option>
                    <option value="8">Test 8</option>
                </select>
            </div>
            
            <div id="imageUploadList"></div>
        </div>
    </div>

    <script>
        let selectedPart = null;
        let pastedImages = {};
        
        const testData = {
            1: {
                part1: [
                    "Do you like to be busy every day? (Why?/Why not?)",
                    "What sport do you enjoy playing? (Why do you like doing that?)",
                    "Do you enjoy watching TV? (What's your favourite programme?) (Why do you like it?)",
                    "Do you ever meet your friends in the evenings after school? (What do you do together?)",
                    "Do you prefer to spend time with your family or with your friends at the weekend? (Why?)"
                ],
                part2: {
                    candidateA: {
                        images: ['1A', '1B'],
                        question: "Compare the photographs, and say what you think the people are enjoying about doing these activities in after school clubs.",
                        followUp: "Which of these activities would you prefer to do? (Why?)"
                    },
                    candidateB: {
                        images: ['1C', '1D'],
                        question: "Compare the photographs, and say why you think the people have decided to take photographs in these situations.",
                        followUp: "Do you enjoy taking photographs? (Why?)"
                    }
                },
                part3: {
                    image: '1E',
                    question: "Talk to each other about whether you think parents should help children with their homework.",
                    followUp: "Now decide what you think is the best reason for parents to help children with their homework."
                },
                part4: [
                    "Do your parents give you a lot of help with your homework? (What do they help with?)",
                    "Some people say that children shouldn't do any homework during the school week. Do you agree? (Why?/Why not?)",
                    "Do you think the school day should be longer so that students don't have to do work at home? (Why?/Why not?)",
                    "Some people say that homework isn't a good thing for children because they stay up too late doing it. What do you think?",
                    "Do you think it would be a good idea for students to do homework online so that the teachers can see what they've done? (Why?/Why not?)"
                ]
            },
            2: {
                part1: [
                    "Do you like to be busy every day? (Why?/Why not?)",
                    "What sport do you enjoy playing? (Why do you like doing that?)",
                    "Do you enjoy watching TV? (What's your favourite programme?) (Why do you like it?)",
                    "Are there a lot of interesting things to do in your town at the weekend? (What do you do there?)",
                    "Can you tell us something about what you're planning to do next weekend?"
                ],
                part2: {
                    candidateA: {
                        images: ['2A', '2B'],
                        question: "Compare the photographs, and say why you think the people are listening carefully in these situations.",
                        followUp: "Do you always listen carefully to your teachers? (Why?)"
                    },
                    candidateB: {
                        images: ['2C', '2D'],
                        question: "Compare the photographs, and say what you think the families are enjoying about spending their holidays in these places.",
                        followUp: "Do you enjoy spending time by the sea? (Why?)"
                    }
                },
                part3: {
                    image: '2E',
                    question: "Talk to each other about whether it's a good idea for people to use the internet to find all the information they need.",
                    followUp: "Now decide what you think is the best reason for people not to depend on the internet for information."
                },
                part4: [
                    "Do you and your friends always use the internet for doing your homework? (Why?/Why not?)",
                    "Do you think parents should control how long their children spend online? (Why?/Why not?)",
                    "Some people think we can learn more from watching television than from going online. What do you think?",
                    "Should computers be part of every lesson at school? (Why?/Why not?)",
                    "Sometimes people try to stay offline for a whole day. Do you think doing that's a good idea? (Why?/Why not?)"
                ]
            },
            3: {
                part1: [
                    "Do you like to be busy every day? (Why?/Why not?)",
                    "What sport do you enjoy playing? (Why do you like doing that?)",
                    "Do you often have to do homework at the weekend? (How do you feel about that?)",
                    "What are you going to do after school today? (Why?)",
                    "What would you like to do for your next birthday? (Why?)"
                ],
                part2: {
                    candidateA: {
                        images: ['3A', '3B'],
                        question: "Compare the photographs, and say why you think the people are working together in these situations.",
                        followUp: "Do you often work together with your friends? (Why?)"
                    },
                    candidateB: {
                        images: ['3C', '3D'],
                        question: "Compare the photographs, and say what you think is difficult for the people about learning these things.",
                        followUp: "Which of these things would you like to learn to do? (Why?)"
                    }
                },
                part3: {
                    image: '3E',
                    question: "Talk to each other about whether it's important for students to learn about their country's traditions and customs when they're at school.",
                    followUp: "Now decide what you think is the best reason for students to learn about their country's traditions and customs."
                },
                part4: [
                    "Is there a custom or tradition in your country that's very popular? (Why do you think it's popular?)",
                    "Do you think it's important to celebrate traditional festivals? (Why?/Why not?)",
                    "Do you think it's true that traditions aren't so important now because countries are becoming more similar? (Why?/Why not?)",
                    "Do you think it is a good idea for schools to organise trips to historic places? (Why?/Why not?)",
                    "Some people say that the best way for children to learn about history is by talking to their grandparents or older people. What do you think?"
                ]
            },
            4: {
                part1: [
                    "Do you like to be busy every day? (Why?/Why not?)",
                    "What sport do you enjoy playing? (Why do you like doing that?)",
                    "Do you prefer to spend time with your family or with your friends at the weekend? (Why?)",
                    "What are you going to do after school today? (Why?)",
                    "Is there something you'd like to learn in the future? (What would you like to learn?) (Why?)"
                ],
                part2: {
                    candidateA: {
                        images: ['4A', '4B'],
                        question: "Compare the photographs, and say what you think the advantages are of studying science in these ways.",
                        followUp: "Do you enjoy studying science? (Why?)"
                    },
                    candidateB: {
                        images: ['4C', '4D'],
                        question: "Compare the photographs, and say why you think these people have decided to spend time on their own.",
                        followUp: "Do you like spending time on your own? (Why?)"
                    }
                },
                part3: {
                    image: '4E',
                    question: "Talk to each other about whether teenagers should spend most of their free time outdoors with their friends.",
                    followUp: "Now decide what you think is the most important reason for teenagers to spend their free time outdoors with their friends."
                },
                part4: [
                    "Do you and your friends spend a lot of your time doing outdoor activities? (Why?/Why not?)",
                    "Should students have to do outdoor sports lessons at school? (Why?/Why not?)",
                    "Do you think it's a good idea for families to go on holidays where they spend a lot of time outside, for example camping holidays? (Why?/Why not?)",
                    "Is growing up in the countryside better for children than living in cities? (Why?/Why not?)",
                    "Some people say that it is important for big cities to have good parks. Do you agree? (Why?/Why not?)"
                ]
            },
            5: {
                part1: [
                    "Do you enjoy long journeys? (What do you do to pass the time?)",
                    "Do you have to travel far every day? (Where do you have to go?)",
                    "What good memories do you have of school?",
                    "Do you prefer individual sports or team sports? (Why?)",
                    "How much time do you spend listening to music? (What kind of music do you like?)"
                ],
                part2: {
                    candidateA: {
                        images: ['5A', '5B'],
                        question: "Compare the photographs, and say what you think the people are enjoying about these guided tours.",
                        followUp: "Would you like to visit either of these places? (Why?/Why not?)"
                    },
                    candidateB: {
                        images: ['5C', '5D'],
                        question: "Compare the photographs, and say why the people have decided to exercise in these ways.",
                        followUp: "Which of these things would you prefer to do? (Why?)"
                    }
                },
                part3: {
                    image: '5E',
                    question: "Talk to each other about which two things you think it's most important to keep up to date with.",
                    followUp: "Now decide what you think is the biggest advantage of keeping up to date with all the changes in the world."
                },
                part4: [
                    "Some people say that we spend too much time checking for updates on social networking websites. Do you agree? (Why?/Why not?)",
                    "Do you think the best way to keep up to date with changes in the world is to watch television? (Why?/Why not?)",
                    "Some people say the world is changing so fast that we can't keep up to date with everything. Do you agree? (Why?/Why not?)",
                    "How important is it for people to have change in their lives?",
                    "Some people don't like it when things change. Why do you think that is?"
                ]
            },
            6: {
                part1: [
                    "Do you enjoy long journeys? (What do you do to pass the time?)",
                    "Do you prefer to travel by car or public transport? (Why?)",
                    "Is there anything you would like to study in the future? (Why?)",
                    "Which is the most popular sport in your country? (Why do you think it's popular?)",
                    "Do you enjoy playing computer games in your free time? (Why?/Why not?)"
                ],
                part2: {
                    candidateA: {
                        images: ['6A', '6B'],
                        question: "Compare the photographs, and say why it might be important to give advice in these situations.",
                        followUp: "Do you like listening to advice? (Why?/Why not?)"
                    },
                    candidateB: {
                        images: ['6C', '6D'],
                        question: "Compare the photographs, and say why you think these people are looking at these beautiful things.",
                        followUp: "Do you enjoy going to museums and galleries? (Why?/Why not?)"
                    }
                },
                part3: {
                    image: '6E',
                    question: "Talk to each other about why people should change the way they spend their free time.",
                    followUp: "Now decide which is the most important reason for changing the way we spend our free time."
                },
                part4: [
                    "Should schools and colleges organise free time activities for students at weekends? (Why?/Why not?)",
                    "Do you think it's true that you will always enjoy yourself if you're with other people? (Why?/Why not?)",
                    "Some people say that it's important to entertain yourself rather than expect other people to do it all the time. What do you think?",
                    "Is it a good idea to have a lot of different interests or just one or two? (Why?/Why not?)",
                    "Do you think it's important to be busy all the time? (Why?/Why not?)"
                ]
            },
            7: {
                part1: [
                    "Do you have to travel far every day? (Where do you have to go?)",
                    "Tell us about an interesting place you've travelled to.",
                    "Have you ever had a part-time job? (What do/did you do? Do/Did you enjoy it?)",
                    "Do you prefer individual sports or team sports? (Why?)",
                    "How much time do you spend listening to music? (What kind of music do you like?)"
                ],
                part2: {
                    candidateA: {
                        images: ['7A', '7B'],
                        question: "Compare the photographs, and say why you think the people have decided to spend time in these quiet places.",
                        followUp: "Which of these places would you prefer to spend time in? (Why?)"
                    },
                    candidateB: {
                        images: ['7C', '7D'],
                        question: "Compare the photographs, and say what you think the people might be enjoying about doing these things at night.",
                        followUp: "Which of these things would you prefer to do? (Why?)"
                    }
                },
                part3: {
                    image: '7E',
                    question: "Talk to each other about whether it's important to learn about other cultures and their customs.",
                    followUp: "Now decide which is the most important reason for learning about other cultures."
                },
                part4: [
                    "Are you interested in the cultures of other countries, for example their music or food? (Why?/Why not?)",
                    "Can we learn a lot about the culture of a country when we're on holiday there? (Why?/Why not?)",
                    "Should students spend more time learning about other cultures when they are at school? (Why?/Why not?)",
                    "Some students have the opportunity to study in another country. Is this a good thing to do? (Why?/Why not?)",
                    "Do you think it's true that the internet has helped us understand people in other countries? (Why?/Why not?)"
                ]
            },
            8: {
                part1: [
                    "Do you enjoy long journeys? (What do you do to pass the time?)",
                    "Tell us about an interesting place you've travelled to.",
                    "Would you prefer to work for a big or small company? (Why?)",
                    "Which is the most popular sport in your country? (Why do you think it's popular?)",
                    "Do you enjoy playing computer games in your free time? (Why?/Why not?)"
                ],
                part2: {
                    candidateA: {
                        images: ['8A', '8B'],
                        question: "Compare the photographs, and say what you think the people are enjoying about spending time by the different rivers.",
                        followUp: "Which of these things would you prefer to do? (Why?)"
                    },
                    candidateB: {
                        images: ['8C', '8D'],
                        question: "Compare the photographs, and say what you think the people are enjoying about being at these events.",
                        followUp: "Which of these events would you prefer to attend? (Why?)"
                    }
                },
                part3: {
                    image: '8E',
                    question: "Talk to each other about whether you think people are too easily influenced by their friends.",
                    followUp: "Now decide what the best reason is for not being too easily influenced by your friends."
                },
                part4: [
                    "Some people say that we always want to have the same things as our friends. What do you think?",
                    "Do you think we can be friends with people who have very different ideas and opinions from us?",
                    "Do you think it's better to have only one or two close friends or have a big group of friends? (Why?)",
                    "How important do you think it is for parents to like their children's friends?",
                    "Some people think that the media influence us much more than our friends do. Do you agree? (Why?/Why not?)"
                ]
            }
        };
        
        // Load saved images from storage
        async function loadImages() {
            try {
                const result = await window.storage.list('image:');
                if (result && result.keys) {
                    for (const key of result.keys) {
                        const data = await window.storage.get(key);
                        if (data && data.value) {
                            pastedImages[key.replace('image:', '')] = data.value;
                        }
                    }
                }
            } catch (e) {
                console.log('No saved images or error loading:', e);
            }
        }
        
        loadImages();
        
        function selectPart(part) {
            selectedPart = part;
            document.querySelectorAll('.part-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('randomBtn').disabled = false;
            document.getElementById('randomBtn').textContent = `Random Part ${part}`;
        }
        
        function randomQuestion() {
            if (!selectedPart) return;
            
            const tests = Object.keys(testData);
            const randomTest = tests[Math.floor(Math.random() * tests.length)];
            const data = testData[randomTest];
            
            let html = `<h2>Test ${randomTest} - Part ${selectedPart}</h2>`;
            
            if (selectedPart === 1) {
                const questions = data.part1;
                const selected = [];
                while (selected.length < Math.min(4, questions.length)) {
                    const q = questions[Math.floor(Math.random() * questions.length)];
                    if (!selected.includes(q)) selected.push(q);
                }
                selected.forEach((q, i) => {
                    html += `<div class="question">${i + 1}. ${q}</div>`;
                });
            }
            
            if (selectedPart === 2) {
                html += '<h3 style="color: #f5576c; margin-top: 20px;">Candidate A</h3>';
                html += '<div class="image-grid">';
                data.part2.candidateA.images.forEach(img => {
                    const imgKey = `${randomTest}${img}`;
                    html += '<div class="image-item">';
                    if (pastedImages[imgKey]) {
                        html += `<img src="${pastedImages[imgKey]}" alt="${img}">`;
                    } else {
                        html += `<div class="placeholder">Image ${img}<br>Not uploaded yet</div>`;
                    }
                    html += `<p>${img}</p></div>`;
                });
                html += '</div>';
                html += `<div class="question" style="margin-top: 20px;"><strong>Task:</strong> ${data.part2.candidateA.question}</div>`;
                html += `<div class="question"><strong>Follow-up for Candidate B:</strong> ${data.part2.candidateA.followUp}</div>`;
                
                html += '<h3 style="color: #f5576c; margin-top: 30px;">Candidate B</h3>';
                html += '<div class="image-grid">';
                data.part2.candidateB.images.forEach(img => {
                    const imgKey = `${randomTest}${img}`;
                    html += '<div class="image-item">';
                    if (pastedImages[imgKey]) {
                        html += `<img src="${pastedImages[imgKey]}" alt="${img}">`;
                    } else {
                        html += `<div class="placeholder">Image ${img}<br>Not uploaded yet</div>`;
                    }
                    html += `<p>${img}</p></div>`;
                });
                html += '</div>';
                html += `<div class="question" style="margin-top: 20px;"><strong>Task:</strong> ${data.part2.candidateB.question}</div>`;
                html += `<div class="question"><strong>Follow-up for Candidate A:</strong> ${data.part2.candidateB.followUp}</div>`;
            }
            
            if (selectedPart === 3) {
                html += '<div class="image-grid">';
                const imgKey = `${randomTest}${data.part3.image}`;
                html += '<div class="image-item">';
                if (pastedImages[imgKey]) {
                    html += `<img src="${pastedImages[imgKey]}" alt="${data.part3.image}" style="height: 400px;">`;
                } else {
                    html += `<div class="placeholder">Image ${data.part3.image}<br>Not uploaded yet</div>`;
                }
                html += `<p>${data.part3.image}</p></div>`;
                html += '</div>';
                html += `<div class="question" style="margin-top: 20px;"><strong>Task:</strong> ${data.part3.question}</div>`;
                html += `<div class="question"><strong>Follow-up:</strong> ${data.part3.followUp}</div>`;
            }
            
            if (selectedPart === 4) {
                const questions = data.part4;
                const selected = [];
                while (selected.length < Math.min(5, questions.length)) {
                    const q = questions[Math.floor(Math.random() * questions.length)];
                    if (!selected.includes(q)) selected.push(q);
                }
                selected.forEach((q, i) => {
                    html += `<div class="question">${i + 1}. ${q}</div>`;
                });
            }
            
            document.getElementById('result').innerHTML = html;
            document.getElementById('result').classList.add('show');
        }
        
        function toggleAdmin() {
            document.getElementById('adminPanel').classList.toggle('show');
            updateImageList();
        }
        
        function updateImageList() {
            const test = document.getElementById('testSelect').value;
            let html = '';
            
            // Part 2 images
            html += '<div class="upload-section"><h3>Part 2 Images</h3>';
            const part2Images = [`${test}A`, `${test}B`, `${test}C`, `${test}D`];
            part2Images.forEach(img => {
                html += createUploadBox(img);
            });
            html += '</div>';
            
            // Part 3 image
            html += '<div class="upload-section"><h3>Part 3 Image</h3>';
            html += createUploadBox(`${test}E`);
            html += '</div>';
            
            document.getElementById('imageUploadList').innerHTML = html;
        }
        
        function createUploadBox(imgId) {
            const hasImage = pastedImages[imgId];
            return `
                <div style="margin-bottom: 20px; padding: 15px; background: white; border-radius: 10px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">Image ${imgId}</h4>
                    <div class="paste-area" 
                         contenteditable="true" 
                         id="paste-${imgId}"
                         onpaste="handlePaste(event, '${imgId}')">
                        ${hasImage ? '‚úì Image uploaded - Paste again to replace' : 'Click here and press Ctrl+V to paste image'}
                    </div>
                    ${hasImage ? `<img src="${pastedImages[imgId]}" class="preview-img" id="preview-${imgId}">` : ''}
                    <div id="preview-container-${imgId}"></div>
                </div>
            `;
        }
        
        async function handlePaste(e, imgId) {
            e.preventDefault();
            const items = e.clipboardData.items;
            
            for (let i = 0; i < items.length; i++) {
                if (items[i].type.indexOf('image') !== -1) {
                    const blob = items[i].getAsFile();
                    const reader = new FileReader();
                    
                    reader.onload = async function(event) {
                        const base64 = event.target.result;
                        pastedImages[imgId] = base64;
                        
                        // Save to storage
                        try {
                            await window.storage.set(`image:${imgId}`, base64);
                            alert(`‚úì Image ${imgId} saved successfully!`);
                        } catch (error) {
                            console.error('Error saving image:', error);
                            alert('Error saving image. It will be kept in memory only.');
                        }
                        
                        // Update preview
                        const previewContainer = document.getElementById(`preview-container-${imgId}`);
                        previewContainer.innerHTML = `<img src="${base64}" class="preview-img">`;
                        
                        document.getElementById(`paste-${imgId}`).innerHTML = '‚úì Image uploaded - Paste again to replace';
                    };
                    
                    reader.readAsDataURL(blob);
                    break;
                }
            }
        }
    </script>
</body>
</html>